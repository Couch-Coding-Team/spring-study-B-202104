# 9.3 애플리케이션 아키텍처

아키텍처 =  어떤 경계 안에 있는 내부 구성요소들이 어떤 책임을 갖고 잇고 어떤 방식으로 서로 관계를 맺고 동작하는지를 규정하는 것(그 구조에서 일어나는 동적인 행위와 깊은 관계)

9.3.1 계층형 아키텍처

- 강한 결합은 오류 발생 가능성이 높아 인터페이스와 같은 유연한 경계를 만들어두고 분리하거나 모아주는 작업이 필요

<아키텍처와 SoC>

- 성격이 다른 코드는 DI를 통해 분리하고 유연한 결합의 인터페이스를 만들어왔던게 지금까지의 구현 전략
- 아키텍처 레벨에서 좀 더 큰 단위에 대해서도 동일하게 적용할 수 잇음
- 애플리케이션을 구성하는 오브젝트들을 비슷한 성격과 책임을 가진 것들끼리 묶을 수 잇음
- 서비스 오브젝트들은 특정 기술과 환경에 종속되지 않으면서 도메인의 업무에는 밀접하게 관련을 갖고 있는 POJO 로 만들어짐
- 성격이 다른 것은 아키텍처 레벨에서 분리해주는 게 좋다.
- 계층형 아키텍처 = 멀티 티어 아키텍처 = 책임과 성격이 다른 것을 크게 그룹으로 만들어 분리해두는 것
- 3계층 애플리케이션 = 보통 웹 기반의 엔터프라이즈 애플리케이션은 일반적으로 3개의 계층을 갖음
- 모두 이 계층을 따르진 않지만 전형적인 웹 엔터프라이즈 애플리케이션은 책임과 성격으로 보자면 일단 3계층의 논리적인 분류가 가능

<3계층 아키텍처와 수직 계층>

![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled.png)

     1) 데이터 엑세스 계층

- DAO 계층이라고 불림
- EIS 계층 = ERP, 레거시 시스템, 메인프레임등에 접근하는 역할 이라고도 함
- 기반 계층 = 외부 시스템을 호출해서 서비스를 이용하는 것
- 데이터 액세스 계층은 수직적 계층
- 역할 구분 = 가로로 표현 / 추상화 = 세로로 표현

    ![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%201.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%201.png)

- 추상화 계층 구조를 따른다면 항상 JdbcTemplate 을 통해 접근하도록 코드를 작성하는 것이 바람직

    ![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%202.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%202.png)

- 새로운 계층에는 신중하게 결정해야 함
- 하위 계층의 변화에 대응해야 하는 책임도 갖음
- 추상계층 추가하는 것이 부담스러우면 공통 기능을 분리해서 유틸리티나 헬퍼 메소드 또는 오브젝트로 제공하는것도 방법(가이드 라인, 코딩 정책 잘 만들자)

     2) 서비스 계층

- 잘 만들어진 스프링 애플리케이션의 서비스 계층 클래스는 이상적인 POJO 로 작성된다.
- POJO 는 객체지향적인 설계 기법이 적용된 코드를 통해서 비즈니스 로직의 핵심을 잘 담아내고 이를 쉽게 테스트하고 유연하게 확장할 수 있다.
- 서비스 계층은 DAO 계층을 호출하고 이를 활용해서 만들어진다.
- 서비스 계층은 특별한 경우가 아니라면 추상화 수직 계층구조를 가질 필요가 없다
- 기술 API를 직접 다루는 코드가 아니기 때문에 필요 없음
- 기반 서비스계층도 독립된 계층의 서비스를 이용하는 것으로 봐야 함
- 아래를 눈여겨 봐야 할 것은 기반 서비스 계층이 서비스 계층의 오브젝트를 호출하는 경우이다
- 일반적으로는 서비스 계층이 필요에 따라 기반 서비스 계층의 API 를 호출해서 이용한다. 하지만 반대로 서비스 계층의 코드를 기반 서비스 계층에서 실행시키는 경우(스케쥴링) 백그라운드 서비스가 필요하다면 그 때는 기반 서비스 계층에서 서비스 계층의 오브젝트를 이용하게 할 수 있음
- 원칙적으로 서비스 계층 코드가 기반 서비스 계층의 구현에 종속되면 안됨
- 서비스 계층의 코드는 추상화된 기반 서비스 인터페이스를 통해서만 접근하도록 만들어서 특정 구현과 기술에 대한 종속성을 제거해야 함 또는 AOP 를 통해서 서비스 계층의 코드를 침범하지 않고 부가기능을 추가하는 방법을 활용해야 한다

    ![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%203.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%203.png)

- 이상적인 서비스 계층은 백엔드 시스템과 연결되는 데이터 액세스 계층이 바뀌고, 클라이언트와 연결되는 프레젠테이션 계층이 모두 바뀌어도 그대로 유지될 수 있어야 함
- 엔터프라이즈 애플리케이션에서 가장 중요한 자산은 도메인의 핵심 비즈니스 로직이 들어 잇는 서비스 계층이어야 함

     3) 프리젠테이션 계층

- 가장 복잡한 계층
- 매우 다양한 진보하는 기술과 프레임워크의 조합을 가질 수 잇음
- 프레젠테이션 계층에서 사용할 기술과 구조를 선택하는 일은 간단하지 않음
- 클라이언트의 종류와 상관없이 HTTP 프로토콜을 사용하는 서블릿이 바탕이 됨
- 방화벽, 보안 문제로  HTTP 로 모두 수렴되는 추세
- 클라이언트와 연결돼서 동작하는 프레젠테이션 계층은 자바에서 HTTP 프로토콜을 처리하는 가장 기본 엔진이 서블릿 기술을 바탕으로 함
- 클라이언트까지 그 범위를 확장될 수 있다
- 최근에는 점점 많은 프레젠테이션 로직이 클라이언트로 이동하고 있는데 RIA/SOFEA 가 대표적
- 스프링은 웹 기반의 프레제네이션 계층을 개발할 수 있는 전용 웹 프레임워크를 제공, 다양한 서드파티 웹 기술을 지원함

<계층형 아키텍처 설계의 원칙>

- 객체지향 설계의 원칙을 따라야함
- 각 계층은 응집도가 높으면서 다른 계층과는 낮은 결합도를 유지할 수 있어야 함
- 각 계층은 자신의 계층의 책임에만 충실해야함
- 데이터 액세스 계층은 데이터 액세스에 관한 모든 것을 스스로 처리해야 하고 다른 기술 API 의 사용을 삼가야 함

![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%204.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%204.png)

- 위처럼 실수하면 안됨
- 데이터 엑세스 계층의 기술과 그 역할을 다른 계층에 노출한다는 점
- JDBC 라는 특정 데이터 액세스 계층 기술에 종속되는 서비스 계층이 됨
- 예외도 특정 데이터 액세스 계층의 구현에 종속되는 강한 결합이 만들어짐

    ![9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%205.png](9%203%20%E1%84%8B%E1%85%A2%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%84%8F%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202cd7f7233a07451bae19c4db606ea4ac/Untitled%205.png)

- 위 처럼 만들어야 함
- User는 사용자 정보의 단순한 오브젝트로 특정 계층이나 구현에 종속되지 않음
- 프레젠테이션 계층의 오브젝트를 그대로 서비스 계층으로 전달하면 안된다
- 계층의 경계를 넘어갈 때는 반드시 특정 계층에 종속되지 않는 오브젝트 형태로 변환해줘야 함
- DI 는 계층을 구분해주지 않기 때문에 빈 사이의 의존관계를 만들때 주의해야 함
- DI를 통해 다른 계층에서 함부로 가져다 쓰면 안됨
-