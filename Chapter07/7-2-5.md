# 7.2.5 자기참조 빈으로 시작하기

<다중 인터페이스 구현과 간접 참조>

- SqlService 의 구현 클래스는 이제 SqlReader 와 SqlRegistry 두 개의 프로퍼티를 DI 받을 수 있는 구조로 만들자.

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled.png)

- 당연히 인터페이스에 의존해야 스프링의 DI 적용 가능
- 굳이 DI 적용하지 않더라도 자신이 사용하는 오브젝트의 클래스가 어떤 것인지를 알지 못하게 만드는 것이 좋다. 그래야 구현 클래스를 바꾸고 의존 오브젝트를 변경해서 자유롭게 확장할 기회를 제공해주는 것
- 클래스의 코드는 단지 인터페이스에 대해서만 알고 있고, 인터페이스를 통해서만 의존 오브젝트에 접근
- 그저 DI 받은 오브젝트를 사용하기만 하면 된다
- 인터페이스는 한 개 이상을 상속하는 것이 허용

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%201.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%201.png)

- 이제부터 책임에 따라 분리되지 않았던 XmlSqlService 클래스를 일단 세분화된 책임을 정의한 인터페이스를 구현하도록 만드는 것

<인터페이스를 이용한 분리>

- 일단 XmlSqlService는 SqlService 만을 구현한 독립적인 클래스라고 생각
- 그렇다면 아래처럼 Reader와 Registry를 만드는게 좋다

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%202.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%202.png)

- sqlMap은 이제 SqlRegistry 구현의 일부가 됐으므로 SqlRegistry 구현 메소드가 아닌 메소드에서는 직접 사용해선 안됨 독립적 오브젝트라고 생각하고 Registry 의 메소드를 통해 접근

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%203.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%203.png)

- 어떻게 읽어오는지는 SqlReader 의 메소드 뒤로 숨기고 어떻게 저장해줄지는 Registry타입 오브젝트가 알아서 처리하도록~
- 먼저 XmlSqlService 가 SqlReader 를 구현하도록 implements 에 선언

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%204.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%204.png)

- 마지막으로 SqlService 인터페이스 구현을 마무리

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%205.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%205.png)

<자기참조 빈 설정>

![7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%206.png](7%202%205%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%200589c6e6d5514e1595621042da9c79ab/Untitled%206.png)
