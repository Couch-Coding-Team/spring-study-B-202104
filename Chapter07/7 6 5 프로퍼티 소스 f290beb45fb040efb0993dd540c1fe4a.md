# 7.6.5 프로퍼티 소스

- 하지만 아직 AppContext 에는 테스트환경에 종속되는 dataSource 의 DB 연결정보가 남음
- AppContext에 정의된 dataSource 빈은 프로파일에 속하지 않은 빈 설정정보이므로 테스트와 운영 시점 모두 동일한 DB 연결정보를 가진 빈이 만들어짐
- 여기서는 스프링 3.1 의 새로운 기능을 설명하기 위해 일단 dataSource 빈의 클래스는 모든 환경에서 동일한 것을 사용한다고 가정
- 문제는 SimpleDriverDataSource 오브젝트를 만든 뒤 DB 연결정보를 프로퍼티 값으로 넣어주는 부분
- 적어도 DB 연결정보는 환경에 따라 다르게 설정될 수 잇어야 함, 같은 종류의 환경이더라도 필요에 따라 손쉽게 변경 가능해야 함
- 그래서 XML이나 프로퍼티 파일 같은 텍스트 파일에 저장해 두는게 좋음

@PropertySource

- 프로퍼티에 들어갈 DB 연결정보는 텍스트로 된 이름과 값의 쌍으로 구성되면 된다.

    ![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled.png)

- @PropertySource = 프로퍼티 소스 등록

    ![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%201.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%201.png)

- @PropertySource 로 등록한 리소스로부터 가져오는 프로퍼티 값은 컨테이너가 관리하는 Environment 타입의 환경 오브젝트에 저장되고 이 환경 오브젝트는 빈처럼 @Autowired 를 통해 필드로 주입받을 수 있음
- getProperty()

![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%202.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%202.png)

- 자바 코드로 전환한 뒤에는 직접 드라이버 클래스의 Class 오브젝트를 넘겨야 했고 이를 다시 프로퍼티 값으로 가져오도록 수정하니 이번에 타입 변환 작업을 직접 해야 함. XML의 편리함에 그리움
- db 연결정보는 설정 클래스에서 완전히 분리됨

<PropertySourcePlaceholderConfigurer>

- 앞에서는 프로퍼티 정보를 가져오기 위해 컨테이너가 관리하는 Environment 타입 오브젝트를 DI 받아서 사용했다.
- 지금까지 사용했던 @Autowired 는 빈 오브젝트를 필드나 수정자 메소드 파라미터로 주입받을 때 사용된다
- dataSource 빈의 프로퍼티는 빈 오브젝트가 아니므로 @Autowired 를 사용할 수 없다. 대신 @Value 어노테이션 사용하면 됨
- 여기서는 프로퍼티 소스로부터 값을 주입받을 수 있게 치환자를 이용해봄
- Value 엔 프로퍼티 이름을 ${} 안에 넣은 문자열을 디폴트 엘리먼트 값으로 지정해줌

    ![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%203.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%203.png)

    ![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%204.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%204.png)

- value 의 디폴트 값으로 넣은 ${db.driverClass}를 치환자라고 부르는 이유는 <property>의 value 에 사용하는 값 치환 방식과 유사
- @Value 와 치환자를 이용해 프로퍼티 값을 필드에 주입하려면 특별한 빈을 하나 선언해줘야함

    ![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%205.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%205.png)

- 빈 팩토리 후처리기로 사용되는 빈을 정의해주는 것인데 이 빈 설정 메소드는 반드시 스태틱 메소드로 선언해야 함
- 이제 @Value 로 선언한 네 개의 필드에는 @PropertySource 로 지정한 파일에서 가져온 프로퍼티 값이 자동으로 주입될 것

![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%206.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%206.png)

![7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%207.png](7%206%205%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%91%E1%85%A5%E1%84%90%E1%85%B5%20%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20f290beb45fb040efb0993dd540c1fe4a/Untitled%207.png)

- try catch 가 없어서 깔끔하지만 dataSource 빈에서만 사용되는 프로퍼티인데 값을 주입받도록 클래스에 필드를 선언하는 것이 조금 부담스러움
- Environment 를 이용해 프로퍼티 값을 가져오는 방법과 @Value 를 이용하는 방법중에 선택하면 됨