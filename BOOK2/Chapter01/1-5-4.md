## 런타임 환경 추상화와 프로파일
애플리케이션의 기능이 바뀌지 않는다면 메타정보도 대부분 바뀌지 않는다. 하지만 애플리케이션이 동작하는 환경에 따라서 바뀌어야 하는 것도 있다. 특히 외부 리소스나 서버환경과 관련이 깊은 애플리케이션 인프라 빈의 클래스와 속성은 같은 애플리케이션이라고 하더라도 실행환경에 따라서 달라질 수 있다.

### 환경에 따른 빈 설정 정보 변경 전략과 한계
애플리케이션이 실행되는 환경(개발환경, 테스트환경, 운영환경)이 달라지면 일부 빈은 환경에 맞게 설정 메타정보를 다르게 구성해야 한다.
- 빈 설정파일의 변경
    - 메타정보를 담은 XML이나 클래스를 따로 준비하는 것이다. 그리고 각 환경에서 스프링 애플리케이션을 실행할 때 다른 설정파일을 사용하게 만든다.
    - 하지만 개발이나 유지보수가 계속 진행되면서 설정정보가 지속적으로 달라지는 경우라면 번거롭고 위험하다.
    - 환경마다 빈 설정정보를 따로 가져가는 것은 여러 면에서 바람직하지 못하다.

- 프로퍼티 파일 활용
    - 빈 설정 메타정보를 담은 XML이나 @Configuration 클래스는 애플리케이션 로직이 바뀌지 않는 한 건드리지 않고 환경에 따라 달라지는 외부 정보만 프로퍼티 파일 등에 두고 XML에서 읽어서 사용한다.
    - 프로퍼티 치환자를 사용해 빈에 주입할 속성 정보를 외부 파일로 빼면 애플리케이션을 구성하는 빈의 설정정보를 환경에 독립적으로 작성해서 환경이 바뀌어도 XML 파일은 수정할 필요가 없다. 대신 각 환경에 따라 달라지는 정보만 프로퍼티 파일 등으로 준비하면 된다.

각 환경에서 빈 메타정보 자체가 바뀌는 경우에는 프로퍼티 파일과 프로퍼티 치환자를 이용한 방법으로는 환경에 따라 설정이 바뀌는 문제를 간단히 해결할 수가 없다.

### 런타임 환경과 프로파일
런타임 환경은 애플리케이션 컨텍스트에 새롭게 도입된 개념이다. 컨텍스트 내부에 Environment 인터페이스를 구현한 런타임 환경 오브젝트가 만들어져서 빈을 생성하거나 의존관계를 주입할 때 사용된다.

프로파일의 개념은 간단하다. 환경에 따라 다르게 구성되는 빈들을 다른 이름을 가진 프로파일 안에 정의한다. 그리고 애플리케이션 컨텍스트가 시작될 때 지정된 프로파일에 속한 빈들만 생성되게 하는 것이다. 환경에 따라 다른 프로파일을 활성화하면 각기 다른 빈들이 사용되는 것이다.
```xml
<beans profile="spring-test">
    <jdbc:embedded-database id="dataSource" type="HSQL">
        <jdbc:script location="schema.sql" />
    </jdbc:embedded-database>
</beans>
```

### 활성 프로파일 지정 방법
특정 프로파일에 정의된 빈을 사용하고 싶으면 해당 프로파일을 활성 프로파일로 만들어주면 된다. 

```java
GenericXmlApplicationContext ac = new GenericXmlApplicationContext();
ac.getEnvironment().setActiveProfiles("spring-test");
ac.load(getClass(), "applicationContext.xml");
ac.refresh();
```

### 프로파일 활용 전략
프로파일별로 어떤 빈을 조합해서 넣을지는 자유지만 프로파일 외부의 빈과 의존관계가 형성되는 경우에는 의존관계가 깨지지 않도록 주의해야한다.

@Configuration이 붙은 클래스를 이용해 빈을 정의하는 경우에도 프로파일을 지정할 수 있다.
```java
@Configuration
@Profile("dev")
public class DevConfig{
    ...
}
```
