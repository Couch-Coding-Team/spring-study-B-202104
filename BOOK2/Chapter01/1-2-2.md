### 빈 등록 방법
#### 스프링에서 자주 사용되는 빈 등록 방법
#### 1. XML : `<bean>` 태그
`<bean>` 태그는 기본적으로 id와 class라는 두 개의 애트리뷰트가 필요하다. 
![image](https://user-images.githubusercontent.com/37647995/119442327-976ed580-bd62-11eb-93a0-104d7393a367.png)<br>
 `<bean>` 태그는 다른 빈의 `<property>` 태그 안에 정의할 수도 있다. 이때는 `<bean>` 의 아이디나 이름을 지정해주지 않는다. 이렇게 다른 빈의 설정 안에 정의되는 빈을 내부 빈 이라고 한다. 내부 빈은 아이디가 없으므로 다른 빈에서 참조할 수 없기 때문에 특정 빈에서만 참조하는 경우에 사용된다.

#### 2. XML : 네임스페이스와 전용 태그
스프링의 빈을 분류하면 애플리케이션의 핵심 코드를 담은 컴포넌트와 서비스 또는 컨테이너 설정을 위한 빈으로 구분할 수 있다.<br>
`hello` 빈은 개발자가 작성한 애플리케이션의 코드로 만든 빈으로, 보통 이런 빈은 직접 코드를 작성해서 만든 클래스를 사용하고 애플리케이션의 핵심 로직을 담고 있다.<br>
AOP를 살펴볼 때 만들어서 사용했던 빈은 성격이 다르다. `mypointcut` 빈은 컨텍스트의 빈 생성 작업 중에 사용하는 AOP를 위한 포인트컷 오브젝트를 정의하고 있다.<br>

![image](https://user-images.githubusercontent.com/37647995/119442433-ca18ce00-bd62-11eb-8718-fd50955e075b.png)<br>

문제는 이렇게 컨텍스트가 사용하는 설정 정보를 담은 빈과 애플리케이션 로직을 담은 빈이 동일한 태그를 사용하면 구분이 잘 안되고, 일반적인 `<bean>` 태그로는 설정 정보의 의도가 쉽게 파악되지 않는다. 그래서 스프링은 의미가 잘 드러나는 네임스페이스와 태그를 가진 설정 방법을 제공한다.<br>

![image](https://user-images.githubusercontent.com/37647995/119442450-d4d36300-bd62-11eb-8c1d-dbe588e4ba46.png)<br>

위 코드는 네임스페이스와 전용 태그, 전용 애트리뷰트를 이용해 선언됐기 때문에 내용이 분명하게 드러나고 선언 자체도 깔끔해진다.<br>
스프링이 제공해주는 것 외에도 개발자가 스스로 커스텀 태그를 만들어서 적용할 수도 있다.개발하는 애플리케이션에서 특정 패턴으로 반복 등장하는 빈 선언이 있다면 `<bean>` 태그 대신 간결한 커스텀 태그를 만드는 것도 고려해 볼 수 있다.

#### 3. 자동 인식을 이용한 빈 등록 : 스테레오타입 어노테이션과 빈 스캐너
XML 문서와 같이 한 곳에 명시적으로 선언하지 않고 빈으로 사용될 클래스에 특별한 어노테이션을 부여해주면 클래스를 자동으로 찾아서 빈으로 등록하게 해줄 수 있다. 이런 방식을 **빈 스캐닝을 통한 자동인식 빈 등록 기능**이라고 하고 이런 스캐닝 작업을 담당하는 오브젝트를 **빈 스캐너**라고 한다.<br>
`@Component` 어노테이션이 부여된 클래스는 빈 등록이 가능하다. `@Component` 어노테이션을 포함해 디폴트 필터에 적용되는 어노테이션을 스프링에서는 스테레오 타입 어노테이션이라고 부른다.

![image](https://user-images.githubusercontent.com/37647995/119442582-1532e100-bd63-11eb-95e8-cf8b71f79278.png)<br>

`AnnotatedHello` 클래스는 스테레오 타입 어노테이션인 `@Component` 가 붙어 있으므로 빈 스캐너가 감지해서 자동으로 빈으로 등록해주는 후보가 된다. 빈 스캐너는 기본적으로 클래스 이름의 첫 글자를 소문자로 바꾸어서 빈의 아이디로 사용한다.

![image](https://user-images.githubusercontent.com/37647995/119442600-1cf28580-bd63-11eb-8cbb-5d30e53d10a0.png)
> `@Component`가 붙은 `AnnotaionHello` 클래스가 빈 스캐너를 통해 등록되는 것을 테스트 하는 코드<br>

`AnnotationConfigApplicationContext` 는 빈 스캐너를 내장하고 있는 애플리케이션 컨텍스트 구현 클래스이다. 이 클래스의 오브젝트를 생성하면서 생성자에 빈 스캔 대상 패키지를 지정해주면 지정한 패키지와 서브 패키지의 클래스 중에서 `@Component`와 같은 스테레오 타입 어노테이션이 붙은 클래스를 모두 찾아 빈으로 등록해준다.

#### 4. 자바 코드에 의한 빈 등록 : `@Configuration` 클래스의 `@Bean` 메소드

스프링은 코드를 이용해서 오브젝트를 생성하고 DI를 진행하는 방식으로 만들어진 오브젝트를 빈으로 쓸 수 있는 방법을 제공한다.<br>

![image](https://user-images.githubusercontent.com/37647995/119442633-2da2fb80-bd63-11eb-8ebf-797e050a0f78.png)<br>

빈 설정 메타정보를 담고 있는 자바 코드는 `@Configuration` 어노테이션이 달린 클래스를 이용해 작성한다. `@Bean` 어노테이션이 붙은 메소드를 통해 빈을 정의할 수 있다.

![image](https://user-images.githubusercontent.com/37647995/119442665-3abfea80-bd63-11eb-9793-d030307d7696.png)<br>
![image](https://user-images.githubusercontent.com/37647995/119442676-3d224480-bd63-11eb-97a4-dcc55e04635f.png)<br>

자바 코드로 만든 빈 설정 메타정보는 어노테이션 설정을 지원하는 컨테이너에 간단히 등록시킬 수 있다. 생성자 파라미터로 `@Configuration` 이 부여된 클래스를 넣어주면 된다.

![image](https://user-images.githubusercontent.com/37647995/119442698-44e1e900-bd63-11eb-95da-8d778872d7da.png)<br>

설정을 담은 자바 코드에 해당하는 `AnnotationHelloConfig` 클래스 자체도 하나의 빈으로 등록된다. 테스트를 진행하면 결과는 성공으로 나온다.<br>

앞에서 테스트로 확인했듯이 스프링 컨테이너는 `AnnotationHelloConfig` 클래스의 어노테이션을 참조해 `annotatedHello()` 메소드를 실행해 이미 `annotatedHello` 라는 이름의 빈 오브젝트를 생성해 놓았다. 1-31 코드를 살펴보면 `annotatedHello()` 메소드는 new 키워드를 이용해 `AnnotationHello` 오브젝트를 생성하도록 되어 있다. 그러니 `annotatedHello()` 메소드를 호출할 때마다 `AnnotationHello` 타입의 새로운 오브젝트를 돌려받을 수 있어야 한다.

![image](https://user-images.githubusercontent.com/37647995/119442740-562af580-bd63-11eb-90a8-826ff7d2ea19.png)<br>

위 코드로 테스트를 진행해보면 실패하게 된다. hello는 이미 컨테이너가 `annotatedHello()` 메소드를 실행해서 얻은 오브젝트이다. hello를 `AnnotatedHelloConfig` 빈의 `annotatedHello()` 메소드를 다시 실행해서 가져온 오브젝트와 비교하면 분명히 다른 오브젝트여야 한다.

![image](https://user-images.githubusercontent.com/37647995/119442771-64791180-bd63-11eb-9ee1-de9d6b35635e.png)<br>

위 코드로 테스트를 진행해보면 테스트에 성공하게 된다. 이 테스트 결과를 통해, 자바 코드를 이용한 빈 등록에 사용되는 클래스는 평범한 자바 코드처럼 동작하지 않는다는 사실을 알아야 한다. `@Bean` 이 붙은 `annotatedHello()` 메소드에서 스프링 컨테이너가 얻을 수 있는 정보는 빈 클래스의 종류와 이름 뿐이다. 나머지 설정 정보는 모두 디폴트 값이 자동으로 적용되기 때문에 이 빈의 메타정보의 스코프는 디폴트인 싱글톤인 것이다. 결국 `annotatedHello` 빈은 싱글톤이므로 컨테이너 안에서 단 한번만 만들어져야 한다.

![image](https://user-images.githubusercontent.com/37647995/119442781-6ba01f80-bd63-11eb-9e6e-e5413cdea284.png)<br>

`printer()` 메소드로 만들어진 빈은 `hello` 와 `hello2` 빈 양쪽에 DI 된다. 스프링은 자바 코드를 사용해서 DI 하는 코드를 만들 었을 때 매번 새로운 오브젝트가 생성되는 문제를 해결해 준다.<br>

자바 코드를 이용한 빈 등록은 단순한 빈 스캐닝을 통한 자동인식으로는 등록하기 힘든 기술 서비스 빈의 등록이나 컨테이너 설정용 빈을 XML 없이 등록하려고 할 때 유용하게 쓸 수 있다.

![image](https://user-images.githubusercontent.com/37647995/119442813-78bd0e80-bd63-11eb-86ec-ee6af6d4e53f.png)
![image](https://user-images.githubusercontent.com/37647995/119442818-7c509580-bd63-11eb-8329-4c1de895e1ea.png)

> 자바 코드에 의한 설정이 유용한 점
> 1. 컴파일러나 IDE를 통한 타입 검증이 가능하다.
> 2. 자동완성과 같은 IDE 지원 기능을 최대한 이용할 수 있다.
> 3. 이해하기 쉽다.
> 4. 복잡한 빈 설정이나 초기화 작업을 손쉽게 적용할 수 있다.

#### 5. 자바 코드에 의한 빈 등록 : 일반 빈 클래스의 `@Bean` 메소드

`@Configuration` 이 붙지 않은 일반 POJO 클래스에도 `@Bean` 을 사용할 수 있다.<br>

![image](https://user-images.githubusercontent.com/37647995/119442858-8b374800-bd63-11eb-8fe9-a8602f971879.png)<br>

하지만 `@Configuration` 이 붙지 않는 클래스에서는 `@Bean` 이 붙은 메소드를 호출해서 DI 하는 코드는 싱글톤으로 처리가 되지 않기 때문에 문제가 발생한다.<br>
printer 빈을 싱글톤으로 만들기 위해서는 `HelloService` 클래스가 `Printer` 빈을 직접 DI 받은 뒤에 이를 각각의 메소드가 사용하게 만들면 된다.

![image](https://user-images.githubusercontent.com/37647995/119442882-968a7380-bd63-11eb-908a-df34c7676e07.png)
![image](https://user-images.githubusercontent.com/37647995/119442892-9a1dfa80-bd63-11eb-88f4-76dde79de354.png)<br>

일반 클래스에서 `@Bean` 을 사용할 경우 이러한 위험성이 있기 때문에 함부로 남용해서는 안되지만 일반적으로 `@Bean` 메소드를 통해 정의되는 빈이 클래스로 만들어지는 빈과 매우 밀접한 관계가 있는 경우이거나 특별히 종속적인 빈인 경우에는 사용할 수 있다.

### 빈 등록 메타정보 구성 전략
#### XML 단독사용
#### XML과 빈 스캐닝의 혼용
빈 스캐닝과 XML을 혼용하는 방법은 각 방법의 장점을 잘 살려서 적용하면 매우 효과적이다. 대부분의 기술 서비스나 컨테이너 설정용 빈은 초기에 XML에 등록해둘 수 있다. 그리고 개발이 진행되면서 만들어지는 애플리케이션 빈들은 스테레오 타입 어노테이션을 부여해서 자동스캔으로 등록할 수 있으므로 XML 설정 파일에 더이상 손대지 않고도 편하게 개발이 가능하다. 또, 자신이 테스트하거나 개발하는데 필요한 빈만 골라서 사용할 수도 있다.

#### XML 없이 빈 스캐닝 단독 사용
애플리케이션 컴포넌트는 물론이고 각종 기술 서비스와 컨테이너 설정용 빈도 모두 스캔으로 자동등록 시키는 것인데, 이 때 자바 코드에 의한 빈 등록 방법이 반드시 필요하다. 기존 XML로 등록했던 기술 서비스 빈과 컨테이너 설정용 빈 등은 `@Configuration` 자바 코드를 이용한 설정 메타정보로 만든다. 이방식은 모든 빈의 정보가 자바 코드에 담겨 있으므로 빈의 설정정보를 타입에 안정한 방식으로 작성할 수 있다는 장점이 있고, 스프링이 제공하는 스키마에 정의된 전용 태그를 사용할 수 없다는 단점이 있다.
