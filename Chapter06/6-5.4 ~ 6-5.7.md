### AOP란 무엇인가
#### 트랜잭션 서비스 추상화
- 트랜잭션 서비스 추상화란 인터페이스와 DI를 통해 '무엇을 하는지' 남기고, 그것을 '어떻게 하는지' 분리한 것이다. '어떻게 하는지'는 더이상 비즈니스 로직 코드에는 영향을 주지 않고 독립적으로 변경할 수 있게 되었다.
- 이 덕분에 비즈니스 로직 코드는 트랜잭션을 어떻게 처리해야 한다는 구체적인 방법과 서버 환경에 종속되지 않는다.
#### 프록시와 데코레이터 패턴
- 클라이언트가 인터페이스와 DI를 통해 서비스에 접근하도록 설계하고, 데코레이터 패턴을 적용하여 비즈니스 로직을 담은 클래스의 코드에는 전혀 영향을 주지 않으면서 트랜잭션이라는 부가 기능을 자유롭게 부여할 수 있는 구조를 만들었다.
#### 다이내믹 프록시와 프록시 팩토리 빈
- 프록시 클래스 없이도 프록시 오브젝트를 런타임 시에 만들어주는 JDK 다이내믹 프록시 기술 덕분에 프록시 클래스 코드 작성의 부담도 덜고, 부가 기능 부여 코드가 중복돼서 나타나는 문제도 해결할 수 있었다.
- 하지만 다이내믹 프록시는 동일한 기능의 프록시를 여러 오브젝트에 적용할 경우 오브젝트 단위로 중복이 일어나는 문제는 해결하지 못했다.
- 그래서 JDK 다이내믹 프록시와 같은 프록시 기술을 추상화 한 스프링의 프록시 팩토리 빈을 이용해서 다이내믹 프록시 생성 방법에 DI를 도입했다.
- 내부적으로 템플릿/콜백 패턴을 활용하는 스프링의 프록시 팩토리 빈 덕분에 어드바이스와 포인트 컷은 프록시에서 분리될 수 있었고, 여러 프록시에서 공유해서 사용할 수 있게 되었다.
#### 자동 프록시 생성 방법과 포인트 컷
- 트랜잭션 적용 대상이 되는 빈은 전부 프록시 팩토리 빈을 설정해줘야 한다는 부담이 남아있다.
- 이를 해결하기 위해서 프록시를 적용할 대상은 패턴을 이용해서 자동으로 선정할 수 있도록, 클래스를 선정하는 기능을 담은 확장된 포인트 컷을 사용했다.
- 결국 트랜잭션 부가 기능을 어디에 적용하는지에 대한 정보를 포인트 컷이라는 독립적인 정보로 완전 분리할 수 있었다.
#### 부가기능의 모듈화
- 트랜잭션 같은 부가 기능은 핵심 기능과 같은 방식으로는 모듈화하기가 매우 힘들다. 이름 그대로 부가 기능이기 때문에 스스로 독립적인 방식으로 존재해서 적용되기 어렵기 때문이다.
- 그래서 지금까지 살펴본 DI, 데코레이터 패턴, 다이내믹 프록시, 오브젝트 생성 후 처리, 자동 프록시 생성, 포인트컷 과 같은 기법으로 문제를 해결해왔다.
- 결국 지금까지 해온 모든 작업은 핵심 기능에 부여되는 부가 기능을 효과적으로 모듈화 하는 방법을 찾는 것이였고, 어드바이스와 포인트 컷을 결합한 어드바이저가 단순하지만 이런 특성을 가진 모듈의 원시적인 형태로 만들어지게 되었다.
#### AOP : 애스펙트 지향 프로그래밍
- aspect(애스펙트) : 그 자체로 애플리케이션의 핵심 기능을 담고 있지는 않지만, 애플리케이션을 구성하는 중요한 한 가지 요소이고, 핵심 기능에 부가 되어 의미를 갖는 특별한 모듈
- 애스펙트는 부가 될 기능을 정의한 코드인 어드바이스와 어드바이스를 어디에 적용할 지를 결정하는 포인트 컷을 함께 가지고 있다. 어드바이저는 아주 단순한 형태의 애스펙트라고 볼 수 있다.
- Aspect Oriented Programming (애스펙트 지향 프로그래밍) : 애플리케이션의 핵심적인 기능에서 부가적인 기능을 분리하여 애스펙트라는 독특한 모듈로 만들어서 설계하고 개발하는 방법

### AOP 적용기술
#### 프록시를 이용한 AOP
- 독립적으로 개발한 부가 기능 모듈을 다양한 타깃 오브젝트의 메소드에 다이내믹하게 적용해주기 위해 가장 중요한 역할을 맡고 있는 게 프록시이다.
- 그래서 스프링 AOP는 프록시 방식의 AOP라고 할 수 있다.
#### 바이트코드 생성과 조작을 통한 AOP
- AspectJ
    - AOP 기술의 원조
    - 가장 강력한 AOP 프레임워크
    - 프록시를 사용하지 않는 대표적인 AOP 기술
    - 타깃 오브젝트를 뜯어 고쳐서 부가 기능을 직접 넣어주는 직접적인 방법을 사용
    > 왜 컴파일 된 클래스 파일 수정이나 바이트 코드 조작과 같은 복잡한 방법을 사용할까?
    > 1. 바이트코드를 조작해서 타깃 오브젝트를 직접 수정해버리면 스프링과 같은 DI 컨테이너의 도움을 받지 않고 AOP를 적용할 수 있기 때문이다.
    > 2. 프록시 방식보다 훨씬 강력하고 유연한 AOP가 가능하기 때문이다. 프록시를 사용하면 부가 기능을 부여할 대상은 클라이언트가 호출할 때 사용하는 메소드로 제한되지만, 바이트 코드를 직접 조작한다면 오브젝트의 생성, 필드 값의 조회와 조작 등 다양한 작업에 부가 기능을 부여해 줄 수 있다.
    - 일반적인 AOP를 적용하는데는 스프링의 AOP로도 충분하다. 특별한 요구사항이 생겨 스프링의 프록시 AOP를 넘어서는 수준이 필요하다면, 그때 AspectJ를 사용하면 된다.

### AOP의 용어
1. 타깃 : 부가 기능을 부여할 대상
2. 어드바이스 : 타깃에게 제공할 부가 기능을 담은 모듈
3. 조인 포인트 : 어드바이스가 적용될 수 있는 위치
4. 포인트 컷 : 어드바이스를 적용할 조인 포인트를 선별하는 작업 또는 그 기능을 정의한 모듈
5. 프록시 : 클라이언트와 타깃 사이에 투명하게 존재하면서 부가 기능을 제공하는 오브젝트
6. 어드바이저 : 포인트커과 어드바이스를 하니씩 가지고 있는 오브젝트, AOP의 가장 기본이 되는 모듈
7. 애스펙트 : AOP의 기본 모듈, 스프링의 어드바이저는 아주 단순한 애스펙트라고 볼 수 있음

### AOP 네임스페이스
스프링의 프록시 방식 AOP를 적용하려면 최소한 네가지 빈을 등록해야 한다.
1. 자동 프록시 생성기 : 스프링의 `DefaultAdvisorAutoProxyCreator` 클래스를 빈으로 등록한다. 빈으로 등록된 어드바이저를 이용해서 프록시를 자동으로 생성하는 기능을 담당한다.
2. 어드바이스 : 부가 기능을 구현한 클래스를 빈으로 등록한다.
3. 포인트 컷 : 스프링의 `AspectJExpressionPointcut` 을 빈으로 등록하고 expression 프로퍼티에 포인트컷 표현식을 넣어주면 된다. 코드를 작성할 필요는 없다.
4. 어드바이저 : 스프링의 `DefaultPointcutAdvisor` 클래스를 빈으로 등록해서 사용한다. 어드바이스와 포인트 컷을 프로퍼티로 참조하는 것 외에 기능은 없고 자동 프록시 생성기에 의해 검색되어 사용된다.

#### AOP 네임스페이스
- 스프링에서는 AOP를 위해 기계적으로 적용되는 빈들을 간편하게 등록하기 위해서 AOP와 관련된 태그를 정의해둔 aop 스키마를 제공한다.
