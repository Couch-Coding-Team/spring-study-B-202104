## 스프링의 기술

### 제어의 역전(IoC) / 의존관계 주입(DI)

질문1. 왜 두 개의 오브젝트를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 지정하는 것일까?

질문2. 이렇게 DI 방식으로 하는 것이 직접 자신이 사용할 오브젝트를 new 키워드로 생성해서 사용하는 강한 결합을 쓰는 방법보다 나은 점은 무엇일까?

→ 유연한 확장이 가능하게 하기 위해서

#### DI의 활용 방법

**1. 핵심 기능의 변경**<br>
A → B 구조에서 A의 기능 일부를 B에게 위임한다고 했을 때 B의 구현 방식을 필요에 따라 통째로 B1, B2, B3로 바꾸는 것
예를들어, 서비스 오브젝트가 사용하는 DAO가 있다고 할 때, DAO의 구현을 JDBC로 했다가 JPA, 하이버네이트 등으로 변경하는 것을 생각할 수 있다.<br>

**2. 핵심기능의 동적인 변경**<br>
DI를 잘 활용하면 애플리케이션이 동작하는 중간에 그 의존 대상을 다이내믹하게 변경할 수 있다.<br>

**3. 부가 기능의 추가**<br>
핵심 기능은 그대로 둔 채로 부가 기능을 추가하는 것인데, 데코레이터 패턴을 생각하면 된다. 인터페이스를 두고 사용하게 하고, 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용할 수 있다. 그래서 핵심 기능과 클라이언트 코드에는 전혀 영향을 주지 않으면서 부가적인 기능을 얼마든지 추가할 수 있다.<br>

**4. 인터페이스의 변경**<br>
때로는 사용하려고 하는 오브젝트가 가진 인터페이스가 클라이언트와 호환되지 않는 경우도 있고, 여러 종류의 인터페이스를 가졌지만 비슷한 기능을 담당하는 오브젝트를 바꿔가면서 사용하고 싶을 때도 있다. 이렇게 클라이언트가 사용하는 인터페이스와 실제 오브젝트 사이에 인터페이스가 일치하지 않는 경우에도 DI가 유용하게 사용된다.<br>

**5. 프록시**<br>
필요한 시점에 실제 사용할 오브젝트를 초기화 하고 리소스를 준비하게 해주는 지연된 로딩을 적용하려면 프록시가 필요하다. 원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시를 적용하려고 할 때도 프록시가 필요하다. 두 가지 방법 모두 DI를 필요로 한다.<br>

**6. 템플릿과 콜백**<br>
반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면 지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있다.<br>

**7. 싱글톤과 오브젝트 스코프**<br>
DI를 프레임워크로 이용한다는 건 DI 대상 오브젝트를 컨테이너가 관리한다는 의미다. 오브젝트 생성부터 관계설정, 이용, 소멸에 이르기까지의 과정을 DI 컨테이너가 주관하기 때문에 그 으보젝트의 스코프를 자유롭게 제어할 수 있다.<br>

**8. 테스트**<br>
테스트를 할 때 의존 오브젝트를 대신해서 스텁 또는 목 오브젝트 같은 테스트 대역을 활용해야 하는데, 이 때 DI가 중요한 역할을 한다. DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동으로 목 오브젝트를 주입할 수있다.<br>

### 애스펙트 지향 프로그래밍(AOP)

#### AOP의 적용 기법

**1. 스프링과 같이 다이내믹 프록시를 사용하는 방법**<br>
이 방법은 기존 코드에 영향을 주지 않고 부가 기능을 적용하게 해주는 데코레이터 패턴을 응용한 것이다. 자바의 객체지향 패턴을 활용한 방법이기 때문에 만들기 쉽고 적용하기 간편하다. 대신 부가 기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점 뿐이라는 제약이 있다.<br>

**2. 자바 언어의 한계를 넘어서 언어의 확장을 이용하는 방법**<br>
AspectJ를 사용하여 메소드 호출 지점 뿐만 아니라 인스턴스 생성, 필드 액세스, 특정호출 경로를 가진 메소드 호출 등에도 부가 기능을 제공할 수 있다. 사용하기 까다롭지만 프록시 방식의 AOP로 할 수 없는 작업을 위해서는 AspectJ를 사용해야 한다.<br>

#### AOP의 적용 단계

**1. 미리 준비된 AOP 이용**<br>
스프링이 미리 만들어서 제공하는 AOP 기능을 그대로 가져다가 적용하는데, 대표적인 AOP는 트랜잭션이다.<br>

**2. 전담팀을 통한 정책 AOP 적용**<br>
아직까지는 개발자 개개인이 AOP 기능을 직접 이용하게 해서는 안되고, 전체적으로 이용 가능한 것을 소수의 AOP 담당자 관리하에 적용해 볼 수 있다. 대표적으로 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트 이용 전후의 작업 기록을 남기는 로깅, 데이터 추적을 위한 트레이싱 같은 정책적으로 이용할 만한 기능에 AOP를 이용하는 것이다.<br>

**3. AOP의 자유로운 이용**<br>
첫 번째와 두 번째 단계를 통해 AOP에 친숙해 졌다면 개발자가 스스로 AOP를 활용할 수 있는 단계로 넘어갈 수 있다. 다른 팀이나 개발자가 만든 코드에 몰래 적용되는 AOP 기능만 아니라면 개발자가 자신이 다루는 코드에 AOP를 적극 활용할 수 있다.<br>

### 포터플 서비스 추상화(PSA)

포터블 서비스 추상화란? 환경과 세부 기술 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해주는 방식이다.
